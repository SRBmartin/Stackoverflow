<div class="page">
  <header class="header">
    <div class="title">
      <span class="dot"></span>
      <h1>
        {{ title }}
        <span class="kpi">
          (<span class="healthy">{{ healthyPct }}%</span> /
           <span class="unhealthy">{{ unhealthyPct }}%</span>)
        </span>
      </h1>
    </div>

    <div class="actions">
      <button class="btn" (click)="load()" [disabled]="loading">
        <span class="icon">&#x21bb;</span>
        Refresh
      </button>
    </div>
  </header>

  <section class="filters">
    <div class="filter">
      <label>Service</label>
      <div class="chip-group">
        <button
          *ngFor="let s of services"
          class="chip"
          [class.active]="serviceFilter === s"
          (click)="serviceFilter = s">
          {{ s }}
        </button>
      </div>
    </div>

    <div class="filter">
      <label>Status</label>
      <div class="chip-group">
        <button class="chip" [class.active]="statusFilter === 'All'" (click)="statusFilter = 'All'">All</button>
        <button class="chip" [class.active]="statusFilter === 'Healthy'" (click)="statusFilter = 'Healthy'">Healthy</button>
        <button class="chip" [class.active]="statusFilter === 'Unhealthy'" (click)="statusFilter = 'Unhealthy'">Unhealthy</button>
      </div>
    </div>
  </section>

  <section class="card">
    <div class="card-header">
      <h2>Latest health checks (last 3 hours)</h2>
      <div class="state" *ngIf="loading">Loadingâ€¦</div>
      <div class="state error" *ngIf="!loading && error">{{ error }}</div>
    </div>

    <div class="table-wrap">
      <table class="grid" aria-label="Health checks">
        <colgroup>
          <col style="width: 28%" />
          <col style="width: 18%" />
          <col style="width: 54%" />
        </colgroup>

        <thead>
          <tr>
            <th>Service</th>
            <th>Status</th>
            <th>Date/Time (Europe/Belgrade)</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let row of filtered; trackBy: trackByRow">
            <td class="service-cell">
              <span class="service-pill" [attr.data-svc]="row.ServiceName">{{ row.ServiceName }}</span>
            </td>
            <td>
              <span class="status"
                    [class.ok]="isHealthy(row.Status)"
                    [class.bad]="!isHealthy(row.Status)">
                {{ row.Status }}
              </span>
            </td>
            <td>{{ formatBelgrade(row.DateTimeUtc) }}</td>
          </tr>

          <tr *ngIf="!loading && !error && filtered.length === 0">
            <td colspan="3" class="empty">No data for the selected filters.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</div>
